<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
    <head>
        <title>Events</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    </head>
    <body>
        <div id="newevent">
            <input type="text" id="newname" placeholder="Enter Title"/>
            <select name="places" id="selectPlace">
                <option disabled selected value>Select Place</option>
                <option th:each="place : ${places}" th:value="${place.getId()}" th:text="${place.getName()}" th:id="${place.getId()}"></option>
            </select>
            <input type="datetime-local" id="startdate"/>
            <input type="datetime-local" id="enddate"/>
            <textarea placeholder="description" id="newdescription"></textarea>
            <button id="createevent">Create New Event</button>
        </div>
        <table th:if="${events != null}">
            <tr th:each="event : ${events}">
                <td><a th:href="@{'/events/'+${event.getID()}}"><span th:text="${event.getName()}"></span></a></td>
            </tr>
        </table>
    </body>
    <script>
        document.getElementById("createevent").addEventListener("click", function(e) {
            var name = document.getElementById("newname").value;
            var place = document.getElementById("selectPlace").value;
            var start = document.getElementById("startdate").value;
            var end = document.getElementById("enddate").value;
            var description = document.getElementById("newdescription").value;
            var message = {
                name : name,
                place : place,
                start : start,
                end : end,
                description : description
            };
            console.log(message);
            try {
                const response = fetch("/new-event", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body : JSON.stringify(message)
                }).then((response) => response.json())
                .then((response) => {
                    window.location.href = window.location.protocol + "//" + window.location.host + "/events/" + response["eid"];
                });
            }
            catch (error) {
                console.log(error);
            }
            console.log(name, index, place, start, end, description);
        });
    </script>
</html>
<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
<style>
    body {
        background-color: #25528F;
    }

    .infoblock {
        background-color: #EDCECD;
        border: 2px solid;
    }

    .settingsbutton, input[type=password], input[type=submit] {
        background-color: #EDCECD;
        border: 2px solid;
        font-size: xx-large;
        width: 75%;
        height: 10%;
        border-radius: 5px;
        left: 50%;
        margin-left: 12.5%;
    }

    .settingsbutton:hover, input[type=password]:hover, input[type=submit]:hover {
        background-color: #25528F;
        color: white;
    }

    .circle {
        border: 2px solid;
        border-radius: 50%;
    }

    .userimage {
        position: relative;
        width: 100%;
    }

    .button, #backbutton {
        background-color: transparent;
        background-repeat: no-repeat;
        border: none;
        cursor: pointer;
        overflow: hidden;
        outline: none;
    }

    .image {
        position: relative;
        width: 100%;
    }

    #Logo {
        border-top-left-radius: 25px;
        border-bottom-right-radius: 0px;
        border-bottom-left-radius: 0px;
        border-top-right-radius: 25px;
        border: 2px solid;
        background-color: #EDCECD;
        width: 25%;
        height: 10%; 

        position: absolute;
        bottom: 5%;
        margin-bottom: 30%;
        left: 50%;
        margin-left: -12.5%;
    }

    #FormBox {
        background-color: #F8E6D0;
        border: 2px solid;
        width: 25%;
        height: 60%;

        position: absolute;
        bottom: 5%;
        left: 50%;
        margin-left: -12.5%;
    }

    #LogoText {
        margin: auto;
        font-size: 100px;
        font-weight: 700;
        text-align: center;
    }

    #home, #location, #search, #chat, #settings, #location, #create {
        position: relative;
        margin-left: 3%;
        left: 20%;
        top: -60%;
        height: 0px;
        width: 5%;
        padding-bottom: 5%;
    }

    #navigationbar {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 75%;
        height: 12%;
        border-bottom-left-radius: 15px;
        border-bottom-right-radius: 15px;
    }

    #famigotext {
        margin: auto;
        font-size: 100px;
        font-weight: 700;
        text-align: left;
        margin-left: 2%;
    }

    #userinfo {
        position: absolute;
        bottom: 0px;
        left: 0px;
        height: 75%;
        width: 20%;
        border-top-right-radius: 15px;
    }

    #userlinks {
        position: absolute;
        bottom: 0px;
        right: 0px;
        height: 75%;
        width: 20%;
        border-top-left-radius: 15px;
    }

    #backbutton {
        position: absolute;
        width: 10%;
        height: 10%;
        margin-top: 0.833%;
        margin-left: 2%;
    }

    input[type=submit] {
        width: 50%;
        margin-left: 25%;
    }

    #password {
        margin-top: 35%;
    }

    #resetfields {
        display: none;
    }

    #settingspage {
        display: none;
    }

    #resetpassword {
        margin-top: 10%;
    }

    #profilepicture {
        position: relative;
        height: 0px;
        width: 50%;
        padding-bottom: 50%;
        margin-left: 24%;
        margin-top: 10%;
    }

</style>
<head> 
    <title>Homepage</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
    <div id="settingspage" class="contents">
        <div id="Logo">
            <p id="LogoText">Settings</p>
        </div>
        <div id="FormBox">
            <button class="settingsbutton" id="resetpassword" onclick="PasswordReset();">
                Change Password
            </button>

            <button class="addon" id="backbutton" onclick="ResetSettings()";>
                <img draggable="false" class="image" th:src="@{/images/backarrow.png}"/>
            </button>

            <form class="addon" id="resetfields" onsubmit="return false">
                <p><input id="password" type="password" placeholder="Password"/></p>
                <p><input id="confirmpassword" type="password" placeholder="Confirm Password"/></p>
                <p><input onclick="ValidatePassword();" type="submit" value="Change Password"/></p>
            </form>
        </div>
    </div>

	<div id="navigationbar" class="infoblock">
        <p id="famigotext">
            Famigo
        </p>

        <button class="button" id="home">
            <img draggable="false" class="image" th:src="@{/images/home.png}"/>
        </button>

        <button class="button" id="chat">
            <img draggable="false" class="image" th:src="@{/images/chat.png}"/>
        </button>

        <button class="button" id="create">
            <img draggable="false" class="image" th:src="@{/images/create.png}"/>
        </button>

        <button class="button" id="location">
            <img draggable="false" class="image" th:src="@{/images/location.png}"/>
        </button>

        <button class="button" id="search">
            <img draggable="false" class="image" th:src="@{/images/search.png}"/>
        </button>

        <button class="button" id="settings" onclick="ShowSettings();">
            <img draggable="false" class="image" th:src="@{/images/settings.png}"/>
        </button>
    </div>

    <div id="userinfo" class="infoblock" th:attr="data-userid=${userpage.getUsername()},data-userloggedin=${user_logged_in.getUsername()}">
        <div class="circle" id="profilepicture">
            <img draggable="false" class="userimage" th:src="@{/images/user.png}"/>
        </div>
        <p>
            Text would go here that gives friends, followers, and possibly info like name and username.
        </p>
        <p th:if="${userpage != null}">
            Username: <span th:text="${userpage.username}"></span>
            <br>
            Followers: <span th:text="${follower_count_of_user}"></span>
            <br>
            Following: <span th:text="${following_count_of_user}"></span>
            <!--testing purposes: Your username: <span th:text="${user_logged_in.username}"></span>-->
        </p>
        <p th:if="${userpage == null}">
            User does not exist.
        </p>
        <p>
            <button id="followbutton" type="button" >Follow</button>
        </p>
    </div>
    
    <script>
        document.getElementById("followbutton").addEventListener("click", function() {
            console.log("button clicked");
            //var user_doing_following = followbutton.parentElement.parentElement.getAttribute("userloggedin");
            //var user_to_be_followed = followbutton.parentElement.parentElement.getAttribute("user-id");
            var userToBeFollowed = document.getElementById("userinfo").getAttribute('data-userid');
            var userDoingFollowing = document.getElementById("userinfo").getAttribute('data-userloggedin');
            var followerCount = 100;
            var isFollowing = true;

            console.log("-->" + document.getElementById("userinfo").value);

            console.log(userToBeFollowed);
            console.log(userDoingFollowing);
            console.log("before follow");

            const formData = new FormData();
            formData.append('userToBeFollowed', userToBeFollowed);
            formData.append('userDoingFollowing', userDoingFollowing);
            formData.append('followerCount', followerCount);
            formData.append('isFollowing', isFollowing);

            
            const response = fetch("/follow", {
                    method : "POST",
                    body : formData
                }).then((response) => response.json()
                ).then((response) => {
                    //window.location.href = window.location.protocol + "//" + window.location.host;
                });

            console.log("after follow");
        });
    </script>

    <div id="userlinks" class="infoblock">
        <p>
            This is where the section links (like detailed stats) would go. How said content is structured is 100% up to the person implementing but should be placed in the center section.
        </p>
    </div>

    <script>
        function RemoveClass(contents) {
            var content = document.getElementsByClassName(contents);
            for (let i = 0; i < content.length; i++) {
                content[i].style.display = "none";
            }
        }

        function AddClass(contents) {
            var content = document.getElementsByClassName(contents);
            for (let i = 0; i < content.length; i++) {
                content[i].style.display = "block";
            }
        }

        function AddElement(element) {
            document.getElementById(element).style.display = "block";
        }

        function ValidatePassword() {
            var password = document.getElementById("password").value;
            var confirmPassword = document.getElementById("confirmpassword").value;
            if (password == confirmPassword && password != "") {
                //TODO: change password in the database
                ResetSettings();
            } else {
                alert("Passwords do not match. Please try again.");
            }
        }

        function ShowSettings() {
            ResetSettings();
            RemoveClass("contents");
            AddElement("settingspage");
            AddClass("settingsbutton");
        }

        function ResetSettings() {
            RemoveClass("addon");
            AddClass("settingsbutton");
            document.getElementById("password").value = "";
            document.getElementById("confirmpassword").value = "";
        }

        function PasswordReset() {
            RemoveClass("settingsbutton");
            AddElement("resetfields");
            AddElement("backbutton");
        }
    </script>
</body>
</html>